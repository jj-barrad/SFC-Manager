<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SFCä¿®è¡Œç®¡ç†ã‚¢ãƒ—ãƒª Stable Core v4</title>
<style>
body{font-family:-apple-system;background:#f3f6fa;margin:0}
header{background:#003f88;color:#fff;padding:14px;text-align:center;font-weight:bold}
.container{padding:15px}
.card{background:#fff;border-radius:14px;padding:14px;margin-bottom:14px;box-shadow:0 4px 12px rgba(0,0,0,0.08)}
input,select,button{width:100%;padding:8px;margin:6px 0;border-radius:8px;border:1px solid #ccc}
button{background:#003f88;color:#fff;font-weight:bold;border:none}
table{width:100%;border-collapse:collapse;font-size:12px}
th,td{border-bottom:1px solid #eee;padding:6px;text-align:center}
.bar{background:#ddd;height:14px;border-radius:8px;margin:4px 0}
.bar-inner{background:#003f88;height:100%;border-radius:8px}
.heat-good{background:#d4edda;padding:10px;border-radius:8px}
.heat-mid{background:#fff3cd;padding:10px;border-radius:8px}
.heat-bad{background:#f8d7da;padding:10px;border-radius:8px}
.small{font-size:13px;color:#666}
.warning{color:#d9534f;font-size:12px}
</style>
</head>
<body>

<header>SFCä¿®è¡Œç®¡ç†ã‚¢ãƒ—ãƒª Stable Core v4</header>

<div class="container">

<div class="card">
<b>ç·åˆçŠ¶æ³</b><br>
äºˆå®šPPï¼š<span id="totalPP">0</span> / 50,000<br>
å®Ÿç¸¾PPï¼š<span id="actualPP">0</span><br>
å¹³å‡PPå˜ä¾¡ï¼š<span id="avgUnit">0</span><br>
é‚£è¦‡æ›ç®—ï¼š<span id="nahaEq">0</span><br>
æœ­å¹Œæ›ç®—ï¼š<span id="ctsEq">0</span>
</div>

<div class="card">
<b>è¨ˆç”»å…¥åŠ›</b>

ãƒ†ãƒ³ãƒ—ãƒ¬åŒºé–“
<select id="template"></select>

å‡ºç™ºåœ°<input id="from">
åˆ°ç€åœ°<input id="to">

ç‰‡é“/å¾€å¾©
<select id="tripType">
<option value="oneway">ç‰‡é“</option>
<option value="round">å¾€å¾©</option>
</select>

èˆªç©ºä¼šç¤¾
<select id="airline">
<option value="ANA">ANA</option>
<option value="other">ä»–ç¤¾</option>
</select>

é‹è³ƒç¨®åˆ¥
<select id="rate"></select>

å›½éš›ç·šè·é›¢ï¼ˆãƒã‚¤ãƒ«ï¼‰<input type="number" id="intlDist" placeholder="å›½å†…ç·šã¯ç©ºæ¬„">
<span id="intlWarning" class="warning"></span>

åº§å¸­
<select id="seat">
<option value="normal">æ™®é€šå¸­</option>
<option value="premium">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ </option>
</select>

ä¾¡æ ¼<input type="number" id="price">
æ­ä¹—æœˆ<input id="month">

<button id="addBtn">è¿½åŠ </button>
</div>

<div class="card">
<b>è¨ˆç”»ä¸€è¦§ï¼ˆç®¡ç†ï¼‰</b>
<table>
<thead>
<tr>
<th>åŒºé–“</th><th>æœˆ</th><th>PP</th><th>ä¾¡æ ¼</th><th>æ¸ˆ</th><th>å‰Šé™¤</th>
</tr>
</thead>
<tbody id="planTable"></tbody>
</table>
</div>

<div class="card"><b>æœˆåˆ¥PP</b><div id="monthly"></div></div>
<div class="card"><b>PPå˜ä¾¡ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—</b><div id="heat"></div></div>

<div class="card">
<b>ANAã‚»ãƒ¼ãƒ«ç›®å®‰</b>
<div class="small">
1æœˆ/4æœˆ/7æœˆ/10æœˆï¼šå›½å†…ç·šã‚¿ã‚¤ãƒ ã‚»ãƒ¼ãƒ«å‚¾å‘<br>
2æœˆ/9æœˆï¼šå›½éš›ç·šã‚»ãƒ¼ãƒ«å‚¾å‘
</div>
</div>

</div>

<script>

/* =========================
   Data Module
========================= */
const DataModule = (function(){
    let plans = JSON.parse(localStorage.getItem("plans")) || [];

    function save(){
        localStorage.setItem("plans", JSON.stringify(plans));
    }

    function getAll(){ return plans; }

    function add(plan){
        plans.push(plan);
        save();
    }

    function remove(index){
        plans.splice(index,1);
        save();
    }

    function toggleDone(index, val){
        plans[index].done = val;
        save();
    }

    return { getAll, add, remove, toggleDone };
})();

/* =========================
   Logic Module
========================= */
const LogicModule = (function(){

    const airportMap = {
        "ç¾½ç”°":"HND","æˆç”°":"NRT","ä¼Šä¸¹":"ITM","é–¢ç©º":"KIX","ä¸­éƒ¨":"NGO",
        "æœ­å¹Œ":"CTS","ç¦å²¡":"FUK","é‚£è¦‡":"OKA","çŸ³å£":"ISG","é¹¿å…å³¶":"KOJ",
        "åºƒå³¶":"HIJ","ä»™å°":"SDJ","å®®å¤":"MMY"
    };

    const distance = {
        "HND-OKA":984,"HND-CTS":510,"HND-FUK":567,"HND-ISG":1224,"HND-KOJ":601,
        "ITM-OKA":739,"ITM-CTS":666,"KIX-OKA":738,"NGO-OKA":758,"FUK-OKA":537
    };

    function convert(name){
        for(let k in airportMap){
            name = name.replaceAll(k, airportMap[k]);
        }
        return name.toUpperCase();
    }

    function isDomestic(from,to){
        return distance[from+"-"+to] || distance[to+"-"+from];
    }

    function calcDomestic(from,to,rate,seat){
        let base = distance[from+"-"+to] || distance[to+"-"+from];
        let pp = base * rate + 400;
        if(seat==="premium") pp *= 1.5;
        return pp;
    }

    function calcIntl(dist,rate){
        return dist * rate;
    }

    return { convert, isDomestic, calcDomestic, calcIntl };

})();

/* =========================
   UI Module
========================= */
const UIModule = (function(){

    function init(){
        initTemplates();
        initRates();
        render();
    }

    function initTemplates(){
        const select = document.getElementById("template");
        const templates = [
            "HND-OKA","HND-CTS","HND-FUK","HND-ISG","HND-KOJ",
            "ITM-OKA","ITM-CTS","KIX-OKA","NGO-OKA","FUK-OKA"
        ];
        select.innerHTML = '<option value="">é¸æŠãªã—</option>';
        templates.forEach(t=>{
            select.innerHTML += `<option value="${t}">${t}</option>`;
        });
        select.addEventListener("change",()=>{
            let val = select.value;
            if(!val) return;
            let arr = val.split("-");
            document.getElementById("from").value = arr[0];
            document.getElementById("to").value = arr[1];
        });
    }

    function initRates(){
        const rateSelect = document.getElementById("rate");
        const rates = [
            ["0.75","ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒãƒªãƒ¥ãƒ¼(75%)"],
            ["1","ãƒãƒªãƒ¥ãƒ¼(100%)"],
            ["1.25","ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ ªä¸»(125%)"],
            ["1","å›½éš›ç·šY/B/M(100%)"],
            ["0.5","å›½éš›ç·šæ ¼å®‰(50%)"]
        ];
        rates.forEach(r=>{
            rateSelect.innerHTML += `<option value="${r[0]}">${r[1]}</option>`;
        });
    }

    function render(){
        let plans = DataModule.getAll();
        let total=0, actual=0, cost=0, monthly={};
        let tableHTML="";

        plans.forEach((p,i)=>{
            total+=p.pp;
            cost+=p.price;
            if(p.done) actual+=p.pp;
            if(p.month){
                if(!monthly[p.month]) monthly[p.month]=0;
                monthly[p.month]+=p.pp;
            }

            tableHTML+=`
            <tr>
            <td>${p.route}</td>
            <td>${p.month||""}</td>
            <td>${p.pp}</td>
            <td>${p.price||""}</td>
            <td><input type="checkbox" ${p.done?"checked":""} data-index="${i}" class="doneCheck"></td>
            <td><button data-index="${i}" class="deleteBtn">å‰Šé™¤</button></td>
            </tr>`;
        });

        document.getElementById("planTable").innerHTML=tableHTML;

        let avg = total? cost/total : 0;

        document.getElementById("totalPP").innerText=total;
        document.getElementById("actualPP").innerText=actual;
        document.getElementById("avgUnit").innerText=avg.toFixed(1);
        document.getElementById("nahaEq").innerText=(total/2276).toFixed(1);
        document.getElementById("ctsEq").innerText=(total/1365).toFixed(1);

        renderMonthly(monthly);
        renderHeat(avg);

        attachEvents();
    }

    function renderMonthly(monthly){
        let html="";
        for(let m in monthly){
            let width=Math.min(monthly[m]/500,100);
            html+=`${m}<div class="bar"><div class="bar-inner" style="width:${width}%"></div></div>`;
        }
        document.getElementById("monthly").innerHTML=html;
    }

    function renderHeat(avg){
        let cls="heat-good";
        if(avg>15) cls="heat-bad";
        else if(avg>13) cls="heat-mid";
        document.getElementById("heat").innerHTML=`<div class="${cls}">å¹³å‡å˜ä¾¡ ${avg.toFixed(1)} å††</div>`;
    }

    function attachEvents(){
        document.querySelectorAll(".doneCheck").forEach(cb=>{
            cb.onclick = ()=> {
                DataModule.toggleDone(cb.dataset.index, cb.checked);
                render();
            };
        });

        document.querySelectorAll(".deleteBtn").forEach(btn=>{
            btn.onclick = ()=>{
                DataModule.remove(btn.dataset.index);
                render();
            };
        });
    }

    return { init, render };

})();

/* =========================
   Input Module
========================= */
const InputModule = (function(){

    function add(){
        let from = LogicModule.convert(document.getElementById("from").value);
        let to = LogicModule.convert(document.getElementById("to").value);
        let type = document.getElementById("tripType").value;
        let airline = document.getElementById("airline").value;
        let rate = parseFloat(document.getElementById("rate").value);
        let seat = document.getElementById("seat").value;
        let price = parseFloat(document.getElementById("price").value)||0;
        let month = document.getElementById("month").value;
        let intl = parseFloat(document.getElementById("intlDist").value);

        let pp=0;
        let route=from+"-"+to;

        if(airline==="ANA"){
            if(LogicModule.isDomestic(from,to)){
                pp+=LogicModule.calcDomestic(from,to,rate,seat);
                if(type==="round") pp+=LogicModule.calcDomestic(to,from,rate,seat);
                document.getElementById("intlWarning").innerText="";
            }else{
                if(!intl){
                    document.getElementById("intlWarning").innerText="â€»å›½éš›ç·šã¯è·é›¢å…¥åŠ›å¿…é ˆ";
                    return;
                }
                pp+=LogicModule.calcIntl(intl,rate);
                if(type==="round") pp+=LogicModule.calcIntl(intl,rate);
            }
        }

        pp=Math.floor(pp);

        DataModule.add({route,pp,price,month,done:false});
        UIModule.render();
    }

    return { add };

})();

/* =========================
   Bootstrap
========================= */
document.getElementById("addBtn").addEventListener("click", InputModule.add);
UIModule.init();
<script>

/* =========================
   Strategy Extension Module
   (Coreã«ã¯è§¦ã‚Œãªã„)
========================= */
const StrategyModule = (function(){

    function calculate(){
        const plans = DataModule.getAll();

        let totalPP = 0;
        let actualPP = 0;
        let totalCost = 0;
        let monthly = {};

        plans.forEach(p=>{
            totalPP += p.pp;
            totalCost += p.price;
            if(p.done) actualPP += p.pp;
            if(p.month){
                if(!monthly[p.month]) monthly[p.month]=0;
                monthly[p.month]+=p.pp;
            }
        });

        const remainPP = 50000 - actualPP;
        const avgUnit = totalPP ? totalCost/totalPP : 0;

        return { totalPP, actualPP, remainPP, avgUnit, monthly };
    }

    function render(){
        const data = calculate();

        let html = "";

        // é”æˆäºˆæ¸¬
        const months = Object.keys(data.monthly).length;
        const remainingMonths = 12 - months;
        let perMonth = remainingMonths>0 ? Math.ceil(data.remainPP/remainingMonths) : 0;

        html += `<b>ğŸ¯ ä¿®è¡Œãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</b><br>`;
        if(data.remainPP<=0){
            html += `ãƒ€ã‚¤ãƒ¤åˆ°é”æ¸ˆã¿<br><br>`;
        }else{
            html += `æ®‹ã‚Š ${data.remainPP} PP<br>`;
            html += `ä»Šå¾Œ æœˆå¹³å‡ ${perMonth} PP å¿…è¦<br><br>`;
        }

        // åŠ¹ç‡ã‚¹ã‚³ã‚¢
        let score = 100;

        if(data.avgUnit > 15) score -= 30;
        else if(data.avgUnit > 13) score -= 15;

        if(remainingMonths < 3) score -= 15;
        if(data.remainPP > 30000) score -= 10;

        if(score<0) score=0;

        html += `<b>ğŸ§  ä¿®è¡ŒåŠ¹ç‡ã‚¹ã‚³ã‚¢</b><br>`;
        html += `${score} / 100<br><br>`;

        // ãƒªã‚¹ã‚¯è¡¨ç¤º
        html += `<b>âš  ãƒªã‚¹ã‚¯åˆ†æ</b><br>`;
        if(data.avgUnit>15){
            html += `å˜ä¾¡ãŒé«˜ã‚ã§ã™ï¼ˆ15å††è¶…ï¼‰<br>`;
        }
        if(remainingMonths<3 && data.remainPP>10000){
            html += `æ®‹æœŸé–“ãŒå°‘ãªã„ã§ã™<br>`;
        }
        if(data.remainPP>40000){
            html += `ä¿®è¡Œæœªç€æ‰‹ã«è¿‘ã„çŠ¶æ…‹ã§ã™<br>`;
        }
        html += `<br>`;

        // äºˆç®—äºˆæ¸¬
        const projectedCost = data.remainPP * (data.avgUnit||12);
        html += `<b>ğŸ’° äºˆæ¸¬å¿…è¦äºˆç®—</b><br>`;
        html += `ç´„ ${Math.floor(projectedCost).toLocaleString()} å††ï¼ˆç¾åœ¨å˜ä¾¡åŸºæº–ï¼‰`;

        document.getElementById("strategyPanel").innerHTML = html;
    }

    return { render };

})();

/* =========================
   Strategy UIè¿½åŠ 
========================= */
(function(){

    const container = document.querySelector(".container");

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `<div id="strategyPanel"></div>`;

    container.appendChild(card);

    // Coreã®renderå¾Œã«ã‚‚æ›´æ–°ã•ã‚Œã‚‹ã‚ˆã†Hook
    const originalRender = UIModule.render;
    UIModule.render = function(){
        originalRender();
        StrategyModule.render();
    };

    // åˆå›æç”»
    StrategyModule.render();

})();
/* =========================
   Ultimate Extension Layer v2
   Coreéå¤‰æ›´ãƒ»å®Œå…¨ä¸Šä¹—ã›
========================= */

const UltimateStrategy = (function(){

    const intlPresets = {
        "HND-HNL": 3831,
        "HND-SIN": 3312,
        "HND-BKK": 2869,
        "HND-ICN": 758,
        "HND-TPE": 1330
    };

    function baseData(){
        const plans = DataModule.getAll();
        let totalPP=0, actualPP=0, totalCost=0, monthly={}, routeStats={};

        plans.forEach(p=>{
            totalPP+=p.pp;
            totalCost+=p.price;
            if(p.done) actualPP+=p.pp;

            if(p.month){
                if(!monthly[p.month]) monthly[p.month]=0;
                monthly[p.month]+=p.pp;
            }

            if(!routeStats[p.route]) routeStats[p.route]={pp:0,cost:0,count:0};
            routeStats[p.route].pp+=p.pp;
            routeStats[p.route].cost+=p.price;
            routeStats[p.route].count++;
        });

        return {plans,totalPP,actualPP,totalCost,monthly,routeStats};
    }

    function roadmap(data){
        const remain=50000-data.actualPP;
        const months=Object.keys(data.monthly).length;
        const remainMonths=Math.max(1,12-months);
        const perMonth=Math.ceil(remain/remainMonths);
        return {remain,remainMonths,perMonth};
    }

    function efficiencyScore(data){
        let score=100;
        const avg=data.totalPP?data.totalCost/data.totalPP:0;
        if(avg>15)score-=30;
        else if(avg>13)score-=15;
        if(data.actualPP<5000)score-=10;
        return Math.max(score,0);
    }

    function bestRoute(data){
        let best=null, bestUnit=999;
        for(let r in data.routeStats){
            const unit=data.routeStats[r].cost/data.routeStats[r].pp;
            if(unit<bestUnit){
                bestUnit=unit;
                best=r;
            }
        }
        return {route:best,unit:bestUnit};
    }

    function simulateCompletion(data){
        const remain=50000-data.actualPP;
        const avgMonthlyPP=Object.values(data.monthly).reduce((a,b)=>a+b,0)/(Object.keys(data.monthly).length||1);

        let success=0;
        for(let i=0;i<500;i++){
            let temp=0;
            for(let m=0;m<12;m++){
                temp+=avgMonthlyPP*(0.8+Math.random()*0.4);
            }
            if(temp>=remain) success++;
        }
        return Math.floor(success/5); // %
    }

    function render(){

        const data=baseData();
        const map=roadmap(data);
        const score=efficiencyScore(data);
        const best=bestRoute(data);
        const prob=simulateCompletion(data);
        const avgUnit=data.totalPP?data.totalCost/data.totalPP:0;
        const projectedCost=map.remain*(avgUnit||12);

        let html="";

        html+=`<b>ğŸ¯ ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</b><br>`;
        html+=`æ®‹ ${map.remain}PP / æœˆ${map.perMonth}PPå¿…è¦<br><br>`;

        html+=`<b>ğŸ“ˆ å®Œäº†ç¢ºç‡</b><br>`;
        html+=`ç´„ ${prob}%<br><br>`;

        html+=`<b>ğŸ§  åŠ¹ç‡ã‚¹ã‚³ã‚¢</b><br>`;
        html+=`${score}/100<br><br>`;

        html+=`<b>ğŸ§­ æœ€é©ãƒ«ãƒ¼ãƒˆå€™è£œ</b><br>`;
        if(best.route){
            html+=`${best.route}ï¼ˆ${best.unit.toFixed(1)}å††/PPï¼‰<br><br>`;
        }else{
            html+=`ãƒ‡ãƒ¼ã‚¿ä¸è¶³<br><br>`;
        }

        html+=`<b>ğŸ’° äºˆæ¸¬æ®‹äºˆç®—</b><br>`;
        html+=`${Math.floor(projectedCost).toLocaleString()}å††<br><br>`;

        html+=`<b>ğŸŒ å›½éš›ç·šè·é›¢ãƒ—ãƒªã‚»ãƒƒãƒˆ</b><br>`;
        for(let r in intlPresets){
            html+=`${r} : ${intlPresets[r]}mi<br>`;
        }

        document.getElementById("ultimatePanel").innerHTML=html;
    }

    return {render};
})();

/* =========================
   UIè¿½åŠ 
========================= */
(function(){
    const container=document.querySelector(".container");

    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`<div id="ultimatePanel"></div>`;
    container.appendChild(card);

    const originalRender=UIModule.render;
    UIModule.render=function(){
        originalRender();
        UltimateStrategy.render();
    };

    UltimateStrategy.render();
})();
</script>
</script>

</body>
</html>