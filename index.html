<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SFC修行管理アプリ Stable Core</title>
<style>
body{font-family:-apple-system;background:#f3f6fa;margin:0}
header{background:#003f88;color:#fff;padding:14px;text-align:center;font-weight:bold}
.container{padding:15px}
.card{background:#fff;border-radius:14px;padding:14px;margin-bottom:14px;box-shadow:0 4px 12px rgba(0,0,0,0.08)}
input,select,button{width:100%;padding:8px;margin:6px 0;border-radius:8px;border:1px solid #ccc}
button{background:#003f88;color:#fff;font-weight:bold;border:none}
.bar{background:#ddd;height:14px;border-radius:8px;margin:4px 0}
.bar-inner{background:#003f88;height:100%;border-radius:8px}
.heat-good{background:#d4edda}
.heat-mid{background:#fff3cd}
.heat-bad{background:#f8d7da}
.small{font-size:13px;color:#666}
</style>
</head>
<body>

<header>SFC修行管理アプリ Stable Core v1</header>

<div class="container">

<div class="card">
<b>総合状況</b><br>
予定PP：<span id="totalPP">0</span> / 50,000<br>
実績PP：<span id="actualPP">0</span><br>
平均PP単価：<span id="avgUnit">0</span><br>
那覇換算回数：<span id="nahaEq">0</span><br>
札幌換算回数：<span id="ctsEq">0</span>
</div>

<div class="card">
<b>計画入力</b>

テンプレ区間
<select id="template" onchange="Input.applyTemplate()">
<option value="">選択なし</option>
<option value="HND-OKA">羽田-那覇</option>
<option value="HND-CTS">羽田-札幌</option>
<option value="ITM-OKA">伊丹-那覇</option>
</select>

出発地
<input id="from">

到着地
<input id="to">

片道/往復
<select id="tripType">
<option value="oneway">片道</option>
<option value="round">往復</option>
</select>

航空会社
<select id="airline">
<option value="ANA">ANA</option>
<option value="other">他社</option>
</select>

運賃種別
<select id="rate">
<option value="0.75">スーパーバリュー(75%)</option>
<option value="1">バリュー(100%)</option>
<option value="1.25">プレミアム株主(125%)</option>
<option value="0.5">国際線格安(50%)</option>
</select>

国際線距離（マイル）
<input type="number" id="intlDist" placeholder="国内線は空欄">

座席
<select id="seat">
<option value="normal">普通席</option>
<option value="premium">プレミアム</option>
</select>

価格（円）
<input type="number" id="price">

搭乗月（例:2026-04）
<input id="month">

<button onclick="Input.add()">追加</button>
</div>

<div class="card">
<b>月別PP</b>
<div id="monthly"></div>
</div>

<div class="card">
<b>PP単価ヒートマップ</b>
<div id="heat"></div>
</div>

<div class="card">
<b>ANAセール目安</b>
<div class="small">
1月/4月/7月/10月：国内線タイムセール傾向<br>
2月/9月：国際線セール傾向<br>
ボーナスマイル：不定期
</div>
</div>

</div>

<script>
const Data={
plans:JSON.parse(localStorage.getItem("plans"))||[],
save(){localStorage.setItem("plans",JSON.stringify(this.plans))}
}

const Logic={
airportMap:{
"羽田":"HND","那覇":"OKA","札幌":"CTS","伊丹":"ITM"
},
distance:{
"HND-OKA":984,
"HND-CTS":510,
"ITM-OKA":739
},
convert(name){
for(let k in this.airportMap){
name=name.replaceAll(k,this.airportMap[k])
}
return name.toUpperCase()
},
calcDomestic(from,to,rate,seat){
let key=from+"-"+to
let base=this.distance[key]||this.distance[to+"-"+from]
if(!base)return 0
let pp=base*rate+400
if(seat==="premium")pp*=1.5
return pp
},
calcIntl(dist,rate){return dist*rate}
}

const Input={
applyTemplate(){
let val=document.getElementById("template").value
if(!val)return
let arr=val.split("-")
document.getElementById("from").value=arr[0]
document.getElementById("to").value=arr[1]
},
add(){
let from=Logic.convert(document.getElementById("from").value)
let to=Logic.convert(document.getElementById("to").value)
let type=document.getElementById("tripType").value
let airline=document.getElementById("airline").value
let rate=parseFloat(document.getElementById("rate").value)
let seat=document.getElementById("seat").value
let price=parseFloat(document.getElementById("price").value)
let month=document.getElementById("month").value
let intl=parseFloat(document.getElementById("intlDist").value)

let pp=0

if(airline==="ANA"){
if(intl){
pp+=Logic.calcIntl(intl,rate)
}else{
pp+=Logic.calcDomestic(from,to,rate,seat)
}
if(type==="round"){
if(intl){
pp+=Logic.calcIntl(intl,rate)
}else{
pp+=Logic.calcDomestic(to,from,rate,seat)
}
}
}

pp=Math.floor(pp)

Data.plans.push({pp,price,month,done:false})
Data.save()
UI.render()
}
}

const UI={
render(){
let total=0,actual=0,cost=0,monthly={}
Data.plans.forEach(p=>{
total+=p.pp
cost+=p.price
if(p.done)actual+=p.pp
if(p.month){
if(!monthly[p.month])monthly[p.month]=0
monthly[p.month]+=p.pp
}
})
let avg=total?cost/total:0

document.getElementById("totalPP").innerText=total
document.getElementById("actualPP").innerText=actual
document.getElementById("avgUnit").innerText=avg.toFixed(1)
document.getElementById("nahaEq").innerText=(total/2276).toFixed(1)
document.getElementById("ctsEq").innerText=(total/1365).toFixed(1)

let mHTML=""
for(let m in monthly){
let width=Math.min(monthly[m]/500,100)
mHTML+=`${m}<div class="bar"><div class="bar-inner" style="width:${width}%"></div></div>`
}
document.getElementById("monthly").innerHTML=mHTML

let hClass="heat-good"
if(avg>15)hClass="heat-bad"
else if(avg>13)hClass="heat-mid"

document.getElementById("heat").innerHTML=
`<div class="${hClass}" style="padding:10px;border-radius:8px">
平均単価 ${avg.toFixed(1)} 円
</div>`
}
}

UI.render()
</script>

</body>
</html>