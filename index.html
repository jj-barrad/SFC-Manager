<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SFC修行 Strategy Engine</title>
<style>
body{margin:0;font-family:-apple-system;background:#f4f6f9;}
header{background:#003f88;color:white;padding:15px;text-align:center;font-weight:bold;}
.container{padding:15px;}
.card{background:white;border-radius:14px;padding:15px;margin-bottom:15px;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
input,select,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc;}
button{background:#003f88;color:white;border:none;font-weight:bold;}
.progress-bar{background:#ddd;height:18px;border-radius:10px;overflow:hidden;}
.progress{background:#003f88;height:100%;width:0%;}
.score{font-size:22px;font-weight:bold;}
</style>
</head>
<body>

<header>SFC修行 Strategy Engine v3</header>

<div class="container">

<div class="card">
<b>総合状況</b><br>
予定PP：<span id="totalPP">0</span> / 50,000<br>
実績PP：<span id="actualPP">0</span><br>
平均単価：<span id="avgUnit">0</span><br>
残必要PP：<span id="remainPP">50000</span><br>
達成予測：<span id="forecast"></span><br>
<div class="progress-bar"><div class="progress" id="progress"></div></div>
</div>

<div class="card">
<b>修行効率スコア</b><br>
<div class="score" id="score">0</div>
</div>

<div class="card">
<b>計画入力</b>

出発地
<input id="from">

到着地
<input id="to">

片道/往復
<select id="tripType">
<option value="oneway">片道</option>
<option value="round">往復</option>
</select>

航空会社
<select id="airline">
<option value="ANA">ANA</option>
<option value="other">他社</option>
</select>

運賃種別
<select id="fareType" onchange="Logic.setRate()">
<option value="0.75">スーパーバリュー(75%)</option>
<option value="1">バリュー(100%)</option>
<option value="1.25">プレミアム株主(125%)</option>
<option value="0.5">国際線格安(50%)</option>
<option value="1">国際線Y/B/M(100%)</option>
</select>

距離（国際線用）
<input id="intlDistance" type="number" placeholder="国際線距離（マイル）">

座席
<select id="seat">
<option value="normal">普通席</option>
<option value="premium">プレミアム</option>
</select>

価格
<input id="price" type="number">

搭乗月（例:2026-04）
<input id="month">

<button onclick="Input.add()">追加</button>
</div>

<div class="card">
<b>修行ロードマップ</b>
<div id="roadmap"></div>
</div>

</div>

<script>

/* ===== DATA ===== */
const Data={
plans:JSON.parse(localStorage.getItem("plans"))||[],
save(){localStorage.setItem("plans",JSON.stringify(this.plans));}
};

/* ===== LOGIC ===== */
const Logic={
airportMap:{
"羽田":"HND","伊丹":"ITM","関空":"KIX","中部":"NGO",
"札幌":"CTS","福岡":"FUK","那覇":"OKA","石垣":"ISG","鹿児島":"KOJ"
},
distance:{
"HND-OKA":984,"HND-CTS":510,"HND-FUK":567,"HND-ITM":280,
"ITM-OKA":739,"OKA-ISG":247
},
convert(name){
for(let k in this.airportMap){name=name.replaceAll(k,this.airportMap[k]);}
return name.toUpperCase();
},
calcDomestic(from,to,rate,seat){
let key=from+"-"+to;
let base=this.distance[key]||this.distance[to+"-"+from];
if(!base) return 0;
let pp=base*rate+400;
if(seat==="premium") pp*=1.5;
return pp;
},
calcIntl(dist,rate){ return dist*rate; },
setRate(){ /* 将来拡張用 */ }
};

/* ===== INPUT ===== */
const Input={
add(){
let from=Logic.convert(document.getElementById("from").value);
let to=Logic.convert(document.getElementById("to").value);
let type=document.getElementById("tripType").value;
let airline=document.getElementById("airline").value;
let rate=parseFloat(document.getElementById("fareType").value);
let seat=document.getElementById("seat").value;
let price=parseFloat(document.getElementById("price").value);
let month=document.getElementById("month").value;
let intlDist=parseFloat(document.getElementById("intlDistance").value);

let totalPP=0;

if(airline==="ANA"){
if(intlDist){
totalPP+=Logic.calcIntl(intlDist,rate);
}else{
totalPP+=Logic.calcDomestic(from,to,rate,seat);
}
if(type==="round"){
if(intlDist){
totalPP+=Logic.calcIntl(intlDist,rate);
}else{
totalPP+=Logic.calcDomestic(to,from,rate,seat);
}
}
}

totalPP=Math.floor(totalPP);

Data.plans.push({pp:totalPP,price,month,done:false});
Data.save();
UI.render();
}
};

/* ===== UI ===== */
const UI={
render(){
let totalPP=0,actualPP=0,totalCost=0,monthly={};
Data.plans.forEach(p=>{
totalPP+=p.pp;
totalCost+=p.price;
if(p.done) actualPP+=p.pp;
if(p.month){
if(!monthly[p.month]) monthly[p.month]=0;
monthly[p.month]+=p.pp;
}
});
let avg= totalPP? totalCost/totalPP:0;
let remain=50000-actualPP;

document.getElementById("totalPP").innerText=totalPP;
document.getElementById("actualPP").innerText=actualPP;
document.getElementById("avgUnit").innerText=avg.toFixed(1);
document.getElementById("remainPP").innerText=remain;
document.getElementById("progress").style.width=(actualPP/50000*100)+"%";

document.getElementById("forecast").innerText=
remain<=0?"達成済み":`あと${remain}PP`;

let score=100;
if(avg>15) score-=30;
if(avg>13) score-=15;
if(Object.keys(monthly).length<3) score-=10;
document.getElementById("score").innerText=score;

let roadmapHTML="";
let monthsLeft=12-Object.keys(monthly).length;
if(monthsLeft>0){
let perMonth=Math.ceil(remain/monthsLeft);
roadmapHTML=`今後${monthsLeft}ヶ月で月${perMonth}PP必要`;
}else{
roadmapHTML="月別計画を追加してください";
}
document.getElementById("roadmap").innerText=roadmapHTML;
}
};

UI.render();

</script>

</body>
</html>