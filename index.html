<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SFC修行 Ultimate版</title>
<style>
body{margin:0;font-family:-apple-system;background:#f2f5f9;}
header{background:#005BAC;color:#fff;padding:15px;text-align:center;font-weight:bold;}
.container{padding:15px;}
.card{background:#fff;border-radius:14px;padding:15px;margin-bottom:15px;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
input,select,button{width:100%;padding:10px;margin-top:6px;margin-bottom:6px;border-radius:8px;border:1px solid #ccc;}
button{background:#005BAC;color:white;border:none;font-weight:bold;}
button.small{width:auto;padding:6px 10px;font-size:12px;margin:3px;}
table{width:100%;border-collapse:collapse;font-size:12px;}
th,td{padding:6px;text-align:center;}
th{background:#f0f0f0;}
.progress-bar{background:#ddd;height:18px;border-radius:10px;overflow:hidden;}
.progress{background:#005BAC;height:100%;width:0%;}
.sale-bar{display:flex;font-size:10px;}
.sale-month{flex:1;padding:3px;text-align:center;}
.strong{background:#c8e6c9;}
.normal{background:#bbdefb;}
.low{background:#eee;}
</style>
</head>
<body>

<header>SFC修行 Ultimate管理版</header>

<div class="container">

<div class="card">
<b>総合状況</b><br>
予定PP：<b id="totalPP">0</b> / 50,000<br>
実績PP：<b id="actualPP">0</b><br>
平均単価：<b id="avgUnit">0</b><br>
予測残予算：<b id="remainBudget">0</b>円<br>
那覇換算残：<b id="remainNaha">0</b>往復<br>
石垣換算残：<b id="remainIshigaki">0</b>往復<br>
<div class="progress-bar"><div class="progress" id="progress"></div></div>
</div>

<div class="card">
<b>テンプレ</b><br>
<button class="small" onclick="setRoute('HND-OKA,OKA-HND')">羽田⇄那覇</button>
<button class="small" onclick="setRoute('HND-CTS,CTS-HND')">羽田⇄札幌</button>
<button class="small" onclick="setRoute('HND-FUK,FUK-HND')">羽田⇄福岡</button>
<button class="small" onclick="setRoute('HND-OKA,OKA-ISG,ISG-OKA,OKA-HND')">羽田⇄石垣</button>
<button class="small" onclick="setRoute('HND-OKA,OKA-MMY,MMY-OKA,OKA-HND')">羽田⇄宮古</button>
</div>

<div class="card">
<b>計画追加</b><br>
地名またはコード
<input id="route">
積算率
<select id="rate">
<option value="0.75">75%</option>
<option value="1">100%</option>
<option value="1.25">125%</option>
</select>
価格
<input id="price" type="number">
搭乗月（例:2026-04）
<input id="month">
<button onclick="addPlan()">追加</button>
</div>

<div class="card">
<b>保存済み</b>
<table>
<thead>
<tr><th>区間</th><th>PP</th><th>単価</th><th>月</th><th>状態</th><th></th></tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>

<div class="card">
<b>月別PP集計</b>
<div id="monthly"></div>
</div>

<div class="card">
<b>年間セール傾向</b>
<div class="sale-bar">
<div class="sale-month strong">1</div>
<div class="sale-month normal">2</div>
<div class="sale-month low">3</div>
<div class="sale-month strong">5</div>
<div class="sale-month normal">6</div>
<div class="sale-month low">7</div>
<div class="sale-month normal">9</div>
<div class="sale-month strong">11</div>
</div>
</div>

</div>

<script>

const airportMap={
"羽田":"HND","成田":"NRT","那覇":"OKA","札幌":"CTS","福岡":"FUK",
"石垣":"ISG","宮古":"MMY","鹿児島":"KOJ","長崎":"NGS","広島":"HIJ","岡山":"OKJ"
};

const distance={
"HND-OKA":984,"OKA-HND":984,
"HND-CTS":510,"CTS-HND":510,
"HND-FUK":567,"FUK-HND":567,
"OKA-ISG":247,"ISG-OKA":247,
"OKA-MMY":177,"MMY-OKA":177
};

let plans=JSON.parse(localStorage.getItem("plans"))||[];

function convertRoute(text){
for(let key in airportMap){
text=text.replaceAll(key,airportMap[key]);
}
return text.toUpperCase();
}

function calcPP(route,rate){
let segs=route.split(",");
let total=0;
segs.forEach(s=>{
if(distance[s]){
total+=distance[s]*rate+400;
}else if(!isNaN(parseInt(s))){
total+=parseInt(s)*rate;
}
});
return Math.floor(total);
}

function heatColor(u){
u=parseFloat(u);
if(u<10) return "#2e7d32";
if(u<13) return "#1565c0";
if(u<16) return "#f9a825";
return "#c62828";
}

function setRoute(r){
document.getElementById("route").value=r;
}

function addPlan(){
let route=convertRoute(document.getElementById("route").value);
let rate=parseFloat(document.getElementById("rate").value);
let price=parseFloat(document.getElementById("price").value);
let month=document.getElementById("month").value;
let pp=calcPP(route,rate);
if(!pp){alert("区間不明");return;}
plans.push({route,pp,price,month,done:false});
localStorage.setItem("plans",JSON.stringify(plans));
render();
}

function toggle(i){
plans[i].done=!plans[i].done;
localStorage.setItem("plans",JSON.stringify(plans));
render();
}

function del(i){
plans.splice(i,1);
localStorage.setItem("plans",JSON.stringify(plans));
render();
}

function render(){
let totalPP=0,actualPP=0,totalCost=0;
let monthly={};
let html="";
plans.forEach((p,i)=>{
totalPP+=p.pp;
totalCost+=p.price;
if(p.done) actualPP+=p.pp;
if(p.month){
if(!monthly[p.month]) monthly[p.month]=0;
monthly[p.month]+=p.pp;
}
let unit=(p.price/p.pp).toFixed(1);
html+=`<tr>
<td>${p.route}</td>
<td>${p.pp}</td>
<td style="background:${heatColor(unit)};color:white">${unit}</td>
<td>${p.month||"-"}</td>
<td><button onclick="toggle(${i})">${p.done?'済':'予定'}</button></td>
<td><button onclick="del(${i})">削除</button></td>
</tr>`;
});
document.getElementById("list").innerHTML=html;
document.getElementById("totalPP").innerText=totalPP;
document.getElementById("actualPP").innerText=actualPP;
let avg= totalPP? (totalCost/totalPP):0;
document.getElementById("avgUnit").innerText=avg.toFixed(1);
document.getElementById("progress").style.width=(actualPP/50000*100)+"%";

let remain=50000-actualPP;
document.getElementById("remainBudget").innerText=Math.floor(remain*avg);
document.getElementById("remainNaha").innerText=(remain/1845).toFixed(1);
document.getElementById("remainIshigaki").innerText=(remain/2140).toFixed(1);

let mhtml="";
for(let m in monthly){
mhtml+=`${m}：${monthly[m]}PP<br>`;
}
document.getElementById("monthly").innerHTML=mhtml;
}

render();

</script>

</body>
</html>