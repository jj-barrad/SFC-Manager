<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SFC修行 Pro v3</title>
<style>
body{margin:0;font-family:-apple-system;background:#f4f6f9;}
header{background:#005BAC;color:white;padding:15px;text-align:center;font-weight:bold;}
.container{padding:15px;}
.card{background:white;border-radius:14px;padding:15px;margin-bottom:15px;box-shadow:0 4px 10px rgba(0,0,0,0.08);}
input,select,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc;}
button{background:#005BAC;color:white;border:none;font-weight:bold;}
table{width:100%;border-collapse:collapse;font-size:12px;}
th,td{padding:6px;text-align:center;}
th{background:#eee;}
.progress-bar{background:#ddd;height:18px;border-radius:10px;overflow:hidden;}
.progress{background:#005BAC;height:100%;width:0%;}
</style>
</head>
<body>

<header>SFC修行 Pro v3</header>

<div class="container">

<div class="card">
<b>総合状況</b><br>
予定PP：<b id="totalPP">0</b> / 50,000<br>
実績PP：<b id="actualPP">0</b><br>
平均単価：<b id="avgUnit">0</b><br>
残必要PP：<b id="remainPP">50000</b><br>
残予算予測：<b id="remainBudget">0</b>円<br>
<div class="progress-bar"><div class="progress" id="progress"></div></div>
</div>

<div class="card">
<b>計画入力</b>

出発地
<input id="from">

到着地
<input id="to">

区分
<select id="tripType">
<option value="oneway">片道</option>
<option value="round">往復</option>
</select>

経由
<select id="via">
<option value="none">なし</option>
<option value="OKA">那覇経由</option>
</select>

航空会社
<select id="airline">
<option value="ANA">ANA</option>
<option value="other">他社</option>
</select>

座席
<select id="seat">
<option value="normal">普通席</option>
<option value="premium">プレミアムクラス</option>
</select>

積算率
<select id="rate">
<option value="0.75">75%</option>
<option value="1">100%</option>
<option value="1.25">125%</option>
</select>

価格
<input id="price" type="number">

搭乗月（例:2026-04）
<input id="month">

<button onclick="addPlan()">追加</button>
</div>

<div class="card">
<b>保存済み</b>
<table>
<thead>
<tr><th>区間</th><th>PP</th><th>単価</th><th>月</th><th>状態</th><th></th></tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>

</div>

<script>

const airportMap={
"羽田":"HND","成田":"NRT","那覇":"OKA","札幌":"CTS","福岡":"FUK",
"石垣":"ISG","宮古":"MMY","鹿児島":"KOJ"
};

const distance={
"HND-OKA":984,"OKA-HND":984,
"HND-CTS":510,"CTS-HND":510,
"HND-FUK":567,"FUK-HND":567,
"OKA-ISG":247,"ISG-OKA":247,
"OKA-MMY":177,"MMY-OKA":177
};

let plans=JSON.parse(localStorage.getItem("plans"))||[];

function codeConvert(name){
for(let k in airportMap){
name=name.replaceAll(k,airportMap[k]);
}
return name.toUpperCase();
}

function segmentPP(seg,rate,seat){
let base=distance[seg];
if(!base) return 0;
let pp=base*rate+400;
if(seat==="premium") pp*=1.5;
return pp;
}

function buildRoute(from,to,via,type){
let segs=[];
if(via==="none"){
segs.push(from+"-"+to);
}else{
segs.push(from+"-OKA");
segs.push("OKA-"+to);
}
if(type==="round"){
if(via==="none"){
segs.push(to+"-"+from);
}else{
segs.push(to+"-OKA");
segs.push("OKA-"+from);
}
}
return segs;
}

function addPlan(){
let from=codeConvert(document.getElementById("from").value);
let to=codeConvert(document.getElementById("to").value);
let type=document.getElementById("tripType").value;
let via=document.getElementById("via").value;
let airline=document.getElementById("airline").value;
let seat=document.getElementById("seat").value;
let rate=parseFloat(document.getElementById("rate").value);
let price=parseFloat(document.getElementById("price").value);
let month=document.getElementById("month").value;

let segments=buildRoute(from,to,via,type);
let totalPP=0;

segments.forEach(seg=>{
if(airline==="ANA"){
totalPP+=segmentPP(seg,rate,seat);
}
});

totalPP=Math.floor(totalPP);

plans.push({route:segments.join(","),pp:totalPP,price,month,done:false});
localStorage.setItem("plans",JSON.stringify(plans));
render();
}

function toggle(i){
plans[i].done=!plans[i].done;
localStorage.setItem("plans",JSON.stringify(plans));
render();
}

function del(i){
plans.splice(i,1);
localStorage.setItem("plans",JSON.stringify(plans));
render();
}

function render(){
let totalPP=0,actualPP=0,totalCost=0;
let html="";
plans.forEach((p,i)=>{
totalPP+=p.pp;
totalCost+=p.price;
if(p.done) actualPP+=p.pp;
let unit=(p.price/p.pp||0).toFixed(1);
html+=`<tr>
<td>${p.route}</td>
<td>${p.pp}</td>
<td>${unit}</td>
<td>${p.month||"-"}</td>
<td><button onclick="toggle(${i})">${p.done?'済':'予定'}</button></td>
<td><button onclick="del(${i})">削除</button></td>
</tr>`;
});
document.getElementById("list").innerHTML=html;
document.getElementById("totalPP").innerText=totalPP;
document.getElementById("actualPP").innerText=actualPP;
let avg= totalPP? (totalCost/totalPP):0;
document.getElementById("avgUnit").innerText=avg.toFixed(1);
let remain=50000-actualPP;
document.getElementById("remainPP").innerText=remain;
document.getElementById("remainBudget").innerText=Math.floor(remain*avg);
document.getElementById("progress").style.width=(actualPP/50000*100)+"%";
}

render();

</script>

</body>
</html>